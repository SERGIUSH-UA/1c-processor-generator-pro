# Web Patterns for 1C Processors

Патерни для створення web-based SPA інтерфейсів в 1С обробках.

> **Коли використовувати:** Мобільні застосунки, кіоски, дашборди з кастомним UI, де потрібен повний контроль над інтерфейсом.

---

## Зміст

1. [Event Queue Pattern](#1-event-queue-pattern) - Комунікація JS → BSL
2. [DOM Manipulation Helpers](#2-dom-manipulation-helpers) - BSL функції для роботи з DOM
3. [Screen Router Pattern](#3-screen-router-pattern) - Навігація між екранами
4. [Bootstrap 5 Integration](#4-bootstrap-5-integration) - Responsive UI
5. [Complete SPA Skeleton](#5-complete-spa-skeleton) - Повний приклад

---

## 1. Event Queue Pattern

Механізм передачі подій з JavaScript в BSL. Потрібен тому що 1C HTMLDocumentField не має прямого callback з JS - тільки OnClick по href.

### JavaScript (вбудовується в HTML template)

```javascript
// Event Queue System
var eventQueue = [];
var queueProcessed = 0;

// Додати подію в чергу
function pushEvent(eventData) {
    eventQueue.push(JSON.stringify(eventData));
}

// Отримати подію по індексу (викликає BSL)
function getEvent(index) {
    return eventQueue[index] || null;
}

// Отримати кількість подій
function getQueueLength() {
    return eventQueue.length;
}

// Хелпер для типових подій
function navigate(screenName) {
    pushEvent({ action: 'navigate', screen: screenName });
}

function submitForm(formId) {
    pushEvent({ action: 'submit', form: formId });
}

function sendData(key, value) {
    pushEvent({ action: 'data', key: key, value: value });
}
```

### BSL - Обробка черги

```bsl
// Глобальна точка входу - викликається з OnClick HTMLDocumentField
&НаКлиенте
Процедура ОбработатьСобытияHTML(ДанныеСобытия)

    Документ = ЭтаФорма.Элементы.WebView.Документ;
    Если Документ = Неопределено Тогда
        Возврат;
    КонецЕсли;

    ОкноДокумента = Документ.defaultView;
    Если ОкноДокумента = Неопределено Тогда
        Возврат;
    КонецЕсли;

    // Fallback для прямих кліків (без черги)
    Если ДанныеСобытия <> Неопределено И ЗначениеЗаполнено(ДанныеСобытия.Href) Тогда
        ОбработатьСсылку(ДанныеСобытия.Href);
    КонецЕсли;

    // Обробка черги подій
    Попытка
        КоличествоСобытий = ОкноДокумента.getQueueLength();
    Исключение
        Возврат; // Черга ще не ініціалізована
    КонецПопытки;

    Пока ОбработаноСобытий < КоличествоСобытий Цикл

        СтрокаJSON = ОкноДокумента.getEvent(ОбработаноСобытий);
        Если СтрокаJSON = Null Тогда
            Прервать;
        КонецЕсли;

        Событие = ПрочитатьДанныеИзJSON(СтрокаJSON);
        ОбработатьСобытие(Событие, Документ);

        ОбработаноСобытий = ОбработаноСобытий + 1;

    КонецЦикла;

КонецПроцедуры

&НаКлиенте
Процедура ОбработатьСобытие(Событие, Документ)

    Если Событие = Неопределено Тогда
        Возврат;
    КонецЕсли;

    Действие = Событие["action"];

    Если Действие = "navigate" Тогда
        ПерейтиНаЭкран(Событие["screen"], Документ);

    ИначеЕсли Действие = "submit" Тогда
        ОбработатьФорму(Событие["form"], Документ);

    ИначеЕсли Действие = "data" Тогда
        ОбработатьДанные(Событие["key"], Событие["value"]);

    КонецЕсли;

КонецПроцедуры

// Хелпер для читання JSON
&НаКлиенте
Функция ПрочитатьДанныеИзJSON(СтрокаJSON)

    Попытка
        ЧтениеJSON = Новый ЧтениеJSON;
        ЧтениеJSON.УстановитьСтроку(СтрокаJSON);
        Результат = ПрочитатьJSON(ЧтениеJSON);
        ЧтениеJSON.Закрыть();
        Возврат Результат;
    Исключение
        Возврат Неопределено;
    КонецПопытки;

КонецФункции
```

### HTML - Використання в onclick

```html
<!-- Навігація -->
<a href="#" onclick="navigate('client'); return false;">Клієнти</a>
<button onclick="navigate('orders')">Замовлення</button>

<!-- Відправка даних -->
<button onclick="sendData('selectedId', '123')">Вибрати</button>

<!-- Форма -->
<button onclick="submitForm('loginForm')">Увійти</button>
```

---

## 2. DOM Manipulation Helpers

BSL модуль для роботи з DOM елементами HTML документа.

```bsl
// Вставити HTML в елемент по селектору
&НаКлиенте
Процедура ВставитьВHTML(Документ, Селектор, HTML) Экспорт

    Элемент = Документ.querySelector(Селектор);
    Если НЕ Элемент = Null Тогда
        Элемент.innerHTML = HTML;
    КонецЕсли;

КонецПроцедуры

// Отримати значення поля вводу
&НаКлиенте
Функция ПолучитьЗначениеПоля(Документ, Селектор) Экспорт

    Элемент = Документ.querySelector(Селектор);
    Если Элемент = Null Тогда
        Возврат "";
    КонецЕсли;

    Возврат Элемент.value;

КонецФункции

// Встановити значення поля вводу
&НаКлиенте
Процедура УстановитьЗначениеПоля(Документ, Селектор, Значение) Экспорт

    Элемент = Документ.querySelector(Селектор);
    Если НЕ Элемент = Null Тогда
        Элемент.value = Значение;
    КонецЕсли;

КонецПроцедуры

// Додати CSS клас
&НаКлиенте
Процедура ДобавитьКласс(Документ, Селектор, ИмяКласса) Экспорт

    Элемент = Документ.querySelector(Селектор);
    Если НЕ Элемент = Null Тогда
        Элемент.classList.add(ИмяКласса);
    КонецЕсли;

КонецПроцедуры

// Видалити CSS клас
&НаКлиенте
Процедура УдалитьКласс(Документ, Селектор, ИмяКласса) Экспорт

    Элемент = Документ.querySelector(Селектор);
    Если НЕ Элемент = Null Тогда
        Элемент.classList.remove(ИмяКласса);
    КонецЕсли;

КонецПроцедуры

// Показати/сховати елемент
&НаКлиенте
Процедура УстановитьВидимость(Документ, Селектор, Видимость) Экспорт

    Элемент = Документ.querySelector(Селектор);
    Если НЕ Элемент = Null Тогда
        Элемент.style.display = ?(Видимость, "", "none");
    КонецЕсли;

КонецПроцедуры

// Встановити текст елемента (без HTML)
&НаКлиенте
Процедура УстановитьТекст(Документ, Селектор, Текст) Экспорт

    Элемент = Документ.querySelector(Селектор);
    Если НЕ Элемент = Null Тогда
        Элемент.textContent = Текст;
    КонецЕсли;

КонецПроцедуры

// Отримати атрибут елемента
&НаКлиенте
Функция ПолучитьАтрибут(Документ, Селектор, ИмяАтрибута) Экспорт

    Элемент = Документ.querySelector(Селектор);
    Если Элемент = Null Тогда
        Возврат "";
    КонецЕсли;

    Возврат Элемент.getAttribute(ИмяАтрибута);

КонецФункции

// Встановити атрибут елемента
&НаКлиенте
Процедура УстановитьАтрибут(Документ, Селектор, ИмяАтрибута, Значение) Экспорт

    Элемент = Документ.querySelector(Селектор);
    Если НЕ Элемент = Null Тогда
        Элемент.setAttribute(ИмяАтрибута, Значение);
    КонецЕсли;

КонецПроцедуры
```

---

## 3. Screen Router Pattern

Навігація між екранами SPA через URL hash.

### BSL Router

```bsl
// Реєстр екранів
&НаКлиенте
Функция ПолучитьНастройкиЭкрана(ИмяЭкрана)

    Экраны = Новый Соответствие;

    // Формат: Ім'я -> Структура(Шаблон, Заголовок, ТребуетАвторизации)
    Экраны.Вставить("login",    Новый Структура("Шаблон, Заголовок", "LoginHTML",    "Вхід"));
    Экраны.Вставить("client",   Новый Структура("Шаблон, Заголовок", "ClientHTML",   "Клієнт"));
    Экраны.Вставить("products", Новый Структура("Шаблон, Заголовок", "ProductsHTML", "Товари"));
    Экраны.Вставить("cart",     Новый Структура("Шаблон, Заголовок", "CartHTML",     "Кошик"));
    Экраны.Вставить("orders",   Новый Структура("Шаблон, Заголовок", "OrdersHTML",   "Замовлення"));

    Возврат Экраны.Получить(НРег(ИмяЭкрана));

КонецФункции

// Головний роутер
&НаКлиенте
Процедура ПерейтиНаЭкран(ИмяЭкрана, Документ)

    Настройки = ПолучитьНастройкиЭкрана(ИмяЭкрана);
    Если Настройки = Неопределено Тогда
        Возврат;
    КонецЕсли;

    // Завантажити контент екрану
    Контент = ПолучитьКонтентЭкрана(Настройки.Шаблон);

    // Оновити DOM
    ВставитьВHTML(Документ, "#content", Контент);
    УстановитьТекст(Документ, "#page-title", Настройки.Заголовок);

    // Оновити активний пункт меню
    ОбновитьМеню(Документ, ИмяЭкрана);

    // Ініціалізувати екран
    ИнициализироватьЭкран(ИмяЭкрана, Документ);

    // Зберегти поточний екран
    ТекущийЭкран = ИмяЭкрана;

КонецПроцедуры

// Завантаження контенту з шаблону
&НаСервере
Функция ПолучитьКонтентЭкрана(ИмяШаблона)

    Попытка
        Макет = РеквизитФормыВЗначение("Объект").ПолучитьМакет(ИмяШаблона);
        Возврат Макет.ПолучитьТекст();
    Исключение
        Возврат "<div class='alert alert-danger'>Екран не знайдено</div>";
    КонецПопытки;

КонецФункции

// Ініціалізація екрану після завантаження
&НаКлиенте
Процедура ИнициализироватьЭкран(ИмяЭкрана, Документ)

    Если ИмяЭкрана = "client" Тогда
        ЗагрузитьДанныеКлиента(Документ);

    ИначеЕсли ИмяЭкрана = "products" Тогда
        ЗагрузитьСписокТоваров(Документ);

    ИначеЕсли ИмяЭкрана = "cart" Тогда
        ОтобразитьКорзину(Документ);

    ИначеЕсли ИмяЭкрана = "orders" Тогда
        ЗагрузитьЗаказы(Документ);

    КонецЕсли;

КонецПроцедуры

// Оновити активний пункт меню
&НаКлиенте
Процедура ОбновитьМеню(Документ, АктивныйЭкран)

    // Зняти активний клас з усіх пунктів
    ПунктыМеню = Документ.querySelectorAll(".nav-link");
    Для Индекс = 0 По ПунктыМеню.length - 1 Цикл
        ПунктыМеню.item(Индекс).classList.remove("active");
    КонецЦикла;

    // Встановити активний
    ДобавитьКласс(Документ, "#nav-" + АктивныйЭкран, "active");

КонецПроцедуры
```

### Обробка URL hash (fallback)

```bsl
// Для прямих посилань типу http://any.link/#screen_name
&НаКлиенте
Процедура ОбработатьСсылку(Href)

    Если СтрНайти(Href, "#") = 0 Тогда
        Возврат;
    КонецЕсли;

    // Витягти hash
    Части = СтрРазделить(Href, "#");
    Если Части.Количество() < 2 Тогда
        Возврат;
    КонецЕсли;

    Команда = Части[1];

    // Розбір параметрів: #screen__param
    Если СтрНайти(Команда, "__") > 0 Тогда
        ЧастиКоманды = СтрРазделить(Команда, "__");
        Действие = ЧастиКоманды[0];
        Параметр = ЧастиКоманды[1];
    Иначе
        Действие = Команда;
        Параметр = "";
    КонецЕсли;

    Документ = ЭтаФорма.Элементы.WebView.Документ;

    // Роутинг
    Если Действие = "login" Тогда
        ПерейтиНаЭкран("login", Документ);

    ИначеЕсли Действие = "client" Тогда
        ПерейтиНаЭкран("client", Документ);

    ИначеЕсли Действие = "product" И ЗначениеЗаполнено(Параметр) Тогда
        ОткрытьТовар(Параметр, Документ);

    ИначеЕсли Действие = "delete" И ЗначениеЗаполнено(Параметр) Тогда
        УдалитьЭлемент(Параметр);

    КонецЕсли;

КонецПроцедуры
```

---

## 4. Bootstrap 5 Integration

### Базовий HTML шаблон

```html
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <style>
        /* Bootstrap CSS (мініфікований, вставляється з шаблону) */
        {{BootstrapCSS}}

        /* Кастомні стилі */
        body {
            padding-bottom: 70px; /* Місце для footer */
            -webkit-user-select: none;
            user-select: none;
        }

        .footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: #fff;
            border-top: 1px solid #dee2e6;
            padding: 10px 0;
            z-index: 1000;
        }

        .footer__item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #6c757d;
            padding: 5px 15px;
        }

        .footer__item.active {
            color: #0d6efd;
            border-bottom: 2px solid #0d6efd;
        }

        .content-area {
            min-height: calc(100vh - 140px);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <nav class="navbar navbar-light bg-light sticky-top">
        <div class="container-fluid">
            <span id="page-title" class="navbar-brand">Завантаження...</span>
            <button onclick="navigate('logout')" class="btn btn-outline-secondary btn-sm">
                Вийти
            </button>
        </div>
    </nav>

    <!-- Content -->
    <main class="container py-3">
        <div id="content" class="content-area">
            <!-- Контент екранів завантажується сюди -->
        </div>
    </main>

    <!-- Footer Navigation -->
    <footer class="footer">
        <div class="container">
            <div class="d-flex justify-content-around">
                <a href="#" id="nav-client" class="footer__item" onclick="navigate('client'); return false;">
                    <svg width="24" height="24"><!-- icon --></svg>
                    <small>Клієнт</small>
                </a>
                <a href="#" id="nav-products" class="footer__item" onclick="navigate('products'); return false;">
                    <svg width="24" height="24"><!-- icon --></svg>
                    <small>Товари</small>
                </a>
                <a href="#" id="nav-cart" class="footer__item" onclick="navigate('cart'); return false;">
                    <svg width="24" height="24"><!-- icon --></svg>
                    <small>Кошик</small>
                </a>
                <a href="#" id="nav-orders" class="footer__item" onclick="navigate('orders'); return false;">
                    <svg width="24" height="24"><!-- icon --></svg>
                    <small>Замовлення</small>
                </a>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script>
        {{EventQueueJS}}
        {{BootstrapJS}}
    </script>
</body>
</html>
```

### Bootstrap компоненти для 1С

```bsl
// Генерація картки товару
&НаКлиенте
Функция СформироватьКарточкуТовара(Товар) Экспорт

    Шаблон = "
    |<div class=""card mb-3"">
    |    <div class=""row g-0"">
    |        <div class=""col-4"">
    |            <img src=""%1"" class=""img-fluid rounded-start"" alt=""%2"">
    |        </div>
    |        <div class=""col-8"">
    |            <div class=""card-body"">
    |                <h5 class=""card-title"">%2</h5>
    |                <p class=""card-text"">%3</p>
    |                <p class=""card-text"">
    |                    <strong>%4 грн</strong>
    |                    <small class=""text-muted"">В наявності: %5</small>
    |                </p>
    |                <button onclick=""sendData('addToCart', '%6')"" class=""btn btn-primary btn-sm"">
    |                    В кошик
    |                </button>
    |            </div>
    |        </div>
    |    </div>
    |</div>";

    Возврат СтрШаблон(Шаблон,
        Товар.Картинка,
        ЭкранироватьHTML(Товар.Наименование),
        ЭкранироватьHTML(Товар.Описание),
        Формат(Товар.Цена, "ЧДЦ=2"),
        Товар.Остаток,
        Товар.Код
    );

КонецФункции

// Генерація списку
&НаКлиенте
Функция СформироватьСписок(Элементы, ФункцияФорматирования) Экспорт

    Если Элементы.Количество() = 0 Тогда
        Возврат "<div class=""alert alert-info"">Список порожній</div>";
    КонецЕсли;

    HTML = "<ul class=""list-group"">";

    Для Каждого Элемент Из Элементы Цикл
        HTML = HTML + "<li class=""list-group-item"">"
            + Выполнить(ФункцияФорматирования + "(Элемент)")
            + "</li>";
    КонецЦикла;

    HTML = HTML + "</ul>";

    Возврат HTML;

КонецФункции

// Екранування HTML
&НаКлиенте
Функция ЭкранироватьHTML(Текст) Экспорт

    Результат = СтрЗаменить(Текст, "&", "&amp;");
    Результат = СтрЗаменить(Результат, "<", "&lt;");
    Результат = СтрЗаменить(Результат, ">", "&gt;");
    Результат = СтрЗаменить(Результат, """", "&quot;");

    Возврат Результат;

КонецФункции
```

---

## 5. Complete SPA Skeleton

Повний робочий приклад конфігурації для генератора.

### config.yaml

```yaml
processor:
  name: WebSPA
  synonym_ru: Веб-застосунок
  synonym_uk: Веб-застосунок
  comment: SPA інтерфейс на Bootstrap 5

attributes:
  - name: ТекущийЭкран
    type: string
    synonym_ru: Поточний екран
  - name: ОбработаноСобытий
    type: number
    synonym_ru: Оброблено подій
  - name: ДанныеСессии
    type: string
    synonym_ru: Дані сесії

templates:
  - name: MainHTML
    type: HTMLDocument
    file: templates/main.html
  - name: ClientHTML
    type: HTMLDocument
    file: templates/client.html
  - name: ProductsHTML
    type: HTMLDocument
    file: templates/products.html
  - name: CartHTML
    type: HTMLDocument
    file: templates/cart.html

forms:
  - name: Форма
    default: true
    elements:
      - type: HTMLDocumentField
        name: WebView
        attribute: WebContent
        stretch: HorizontalAndVertically
        title_location: None
    events:
      OnCreateAtServer: ПриСозданииНаСервере
      OnOpen: ПриОткрытии
```

### handlers.bsl

```bsl
// === ФОРМА ===

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

    // Завантажити головний шаблон
    Макет = РеквизитФормыВЗначение("Объект").ПолучитьМакет("MainHTML");
    WebContent = Макет.ПолучитьТекст();

    ТекущийЭкран = "login";
    ОбработаноСобытий = 0;

КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)

    // Підключити обробник подій
    ПодключитьОбработчикОжидания("ОбработатьСобытияОжидание", 0.1, Ложь);

КонецПроцедуры

// === EVENT LOOP ===

&НаКлиенте
Процедура ОбработатьСобытияОжидание()

    ОбработатьСобытияHTML(Неопределено);
    ПодключитьОбработчикОжидания("ОбработатьСобытияОжидание", 0.1, Ложь);

КонецПроцедуры

&НаКлиенте
Процедура WebViewOnClick(Элемент, ДанныеСобытия, СтандартнаяОбработка)

    СтандартнаяОбработка = Ложь;
    ОбработатьСобытияHTML(ДанныеСобытия);

КонецПроцедуры

// === ГОЛОВНИЙ ОБРОБНИК ===

&НаКлиенте
Процедура ОбработатьСобытияHTML(ДанныеСобытия)

    Документ = ЭтаФорма.Элементы.WebView.Документ;
    Если Документ = Неопределено Тогда
        Возврат;
    КонецЕсли;

    ОкноДокумента = Документ.defaultView;
    Если ОкноДокумента = Неопределено Тогда
        Возврат;
    КонецЕсли;

    // Fallback для прямих кліків
    Если ДанныеСобытия <> Неопределено И ЗначениеЗаполнено(ДанныеСобытия.Href) Тогда
        ОбработатьСсылку(ДанныеСобытия.Href);
    КонецЕсли;

    // Обробка черги
    Попытка
        КоличествоСобытий = ОкноДокумента.getQueueLength();
    Исключение
        Возврат;
    КонецПопытки;

    Пока ОбработаноСобытий < КоличествоСобытий Цикл

        СтрокаJSON = ОкноДокумента.getEvent(ОбработаноСобытий);
        Если СтрокаJSON = Null Тогда
            Прервать;
        КонецЕсли;

        Событие = ПрочитатьДанныеИзJSON(СтрокаJSON);
        ОбработатьСобытие(Событие, Документ);

        ОбработаноСобытий = ОбработаноСобытий + 1;

    КонецЦикла;

КонецПроцедуры

// === РОУТЕР ===

&НаКлиенте
Процедура ОбработатьСобытие(Событие, Документ)

    Если Событие = Неопределено Тогда
        Возврат;
    КонецЕсли;

    Действие = Событие["action"];

    Если Действие = "navigate" Тогда
        ПерейтиНаЭкран(Событие["screen"], Документ);

    ИначеЕсли Действие = "submit" Тогда
        ОбработатьФорму(Событие["form"], Документ);

    ИначеЕсли Действие = "data" Тогда
        ОбработатьДанные(Событие["key"], Событие["value"], Документ);

    КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура ПерейтиНаЭкран(ИмяЭкрана, Документ)

    Контент = ПолучитьКонтентЭкранаНаСервере(ИмяЭкрана);

    Элемент = Документ.querySelector("#content");
    Если НЕ Элемент = Null Тогда
        Элемент.innerHTML = Контент;
    КонецЕсли;

    ТекущийЭкран = ИмяЭкрана;

    // Ініціалізація екрану
    ИнициализироватьЭкран(ИмяЭкрана, Документ);

КонецПроцедуры

&НаСервере
Функция ПолучитьКонтентЭкранаНаСервере(ИмяЭкрана)

    Соответствие = Новый Соответствие;
    Соответствие.Вставить("client", "ClientHTML");
    Соответствие.Вставить("products", "ProductsHTML");
    Соответствие.Вставить("cart", "CartHTML");

    ИмяМакета = Соответствие.Получить(НРег(ИмяЭкрана));
    Если ИмяМакета = Неопределено Тогда
        Возврат "<div class='alert alert-warning'>Екран не знайдено</div>";
    КонецЕсли;

    Попытка
        Макет = РеквизитФормыВЗначение("Объект").ПолучитьМакет(ИмяМакета);
        Возврат Макет.ПолучитьТекст();
    Исключение
        Возврат "<div class='alert alert-danger'>Помилка завантаження</div>";
    КонецПопытки;

КонецФункции

// === ХЕЛПЕРИ ===

&НаКлиенте
Функция ПрочитатьДанныеИзJSON(СтрокаJSON)

    Попытка
        ЧтениеJSON = Новый ЧтениеJSON;
        ЧтениеJSON.УстановитьСтроку(СтрокаJSON);
        Результат = ПрочитатьJSON(ЧтениеJSON);
        ЧтениеJSON.Закрыть();
        Возврат Результат;
    Исключение
        Возврат Неопределено;
    КонецПопытки;

КонецФункции
```

---

## Важливі нюанси (lessons learned)

### 1. Видимість через CSS класи, не inline style

**Проблема:** `element.style.display = ""` не перебиває CSS правило `.screen { display: none }`.

**Рішення:** Використовувати класи:
```css
.screen { display: none; }
.screen.active { display: block; }
```

```bsl
// Правильно - через класи
УдалитьКласс(Документ, "#screen-home", "active");
ДобавитьКласс(Документ, "#screen-clients", "active");

// Неправильно - inline style не працює з CSS display:none
// УстановитьВидимость(Документ, "#screen-home", Ложь);
```

### 2. Wait Handler з малим інтервалом

**Проблема:** `ПодключитьОбработчикОжидания("...", 0.2, Ложь)` - помилка "нульова затримка тільки для однократного виконання".

**Рішення:** Використовувати `Истина` (одноразово) і перепідключати в кінці:
```bsl
&НаКлиенте
Процедура ПриОткрытии(Отказ)
    ПодключитьОбработчикОжидания("ПроверитьОчередь", 0.5, Истина);
КонецПроцедуры

&НаКлиенте
Процедура ПроверитьОчередь()
    ОбработатьСобытия();
    // Перепідключити для наступної ітерації
    ПодключитьОбработчикОжидания("ПроверитьОчередь", 0.5, Истина);
КонецПроцедуры
```

### 3. Object vs Form атрибути

Атрибути з `attributes:` в YAML - це атрибути об'єкта. Доступ через `Объект.`:
```bsl
// Правильно
Объект.WebContent = Макет.ПолучитьТекст();
Объект.ТекущийЭкран = "home";

// Неправильно - не знайде атрибут
WebContent = Макет.ПолучитьТекст();
```

---

## Обмеження та рекомендації

### Що працює в 1C HTMLDocumentField:
- Inline CSS та `<style>` блоки
- Inline JavaScript та `<script>` блоки
- SVG графіка
- DOM API (querySelector, innerHTML, classList)
- JSON.stringify/parse
- CSS Grid, Flexbox
- Bootstrap 5 (inline)

### Що НЕ працює:
- Emoji (використовуйте SVG)
- External CDN (все має бути inline)
- ES6+ синтаксис (arrow functions, let/const в старих версіях)
- Fetch API до зовнішніх ресурсів
- localStorage/sessionStorage
- WebSocket

### Рекомендації:
1. **Мініфікуйте CSS/JS** перед вбудовуванням в шаблони
2. **Використовуйте SVG** замість іконочних шрифтів
3. **Тестуйте в thin client** - там інший движок рендерингу
4. **Кешуйте контент** в атрибутах форми
5. **Обробляйте помилки** - DOM може бути недоступний
