// ============================================================================
// Демонстрація модульних змінних (Перем) v2.73.0
// ============================================================================

// ----------------------------------------------------------------------------
// Модульні змінні FormModule
// ----------------------------------------------------------------------------

// Клієнтські змінні для гри
&НаКлиенте
Перем Направление, Позиция, Очки;  // Стан гри

// Ще одна клієнтська змінна
&НаКлиенте
Перем ИграАктивна;

// Серверні змінні для кешування
&НаСервере
Перем СерверныйКеш;  // Кеш даних

// Змінна без директиви (доступна скрізь)
Перем ОбщаяПеременная;

// ----------------------------------------------------------------------------
// Код для ObjectModule (експортовані змінні)
// ----------------------------------------------------------------------------

#Область МодульОбъекта

// Експортовані змінні модуля об'єкта
Перем ПараметрыОбработки Экспорт;  // Параметри обробки
Перем КешРезультатов Экспорт;      // Кеш результатів
Перем СчетчикВызовов;              // Внутрішній лічильник

Функция ПолучитьПараметры() Экспорт
    Если ПараметрыОбработки = Неопределено Тогда
        ПараметрыОбработки = Новый Структура;
        ПараметрыОбработки.Вставить("Версия", "2.73.0");
        ПараметрыОбработки.Вставить("Автор", "1C-PG");
    КонецЕсли;

    СчетчикВызовов = СчетчикВызовов + 1;
    Возврат ПараметрыОбработки;
КонецФункции

Процедура ОчиститьКешРезультатов() Экспорт
    КешРезультатов = Неопределено;
    СчетчикВызовов = 0;
КонецПроцедуры

#КонецОбласти

// ----------------------------------------------------------------------------
// Обробники подій форми
// ----------------------------------------------------------------------------

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
    // Ініціалізація серверного кешу
    СерверныйКеш = Новый Соответствие;
    ОбщаяПеременная = "Ініціалізовано";

    Объект.СтатусИгры = "Готово до старту";
КонецПроцедуры

// ----------------------------------------------------------------------------
// Обробники команд гри (використовують клієнтські змінні)
// ----------------------------------------------------------------------------

&НаКлиенте
Процедура НачатьИгру(Команда)
    // Ініціалізація клієнтських змінних
    Направление = "Вправо";
    Позиция = Новый Структура("X, Y", 5, 5);
    Очки = 0;
    ИграАктивна = Истина;

    Объект.СтатусИгры = "Гра активна";
    Объект.Счетчик = Очки;
КонецПроцедуры

&НаКлиенте
Процедура ОстановитьИгру(Команда)
    Если НЕ ИграАктивна Тогда
        Сообщить("Гра не запущена!");
        Возврат;
    КонецЕсли;

    ИграАктивна = Ложь;
    Объект.СтатусИгры = "Гра зупинена. Очки: " + Очки;
КонецПроцедуры

&НаКлиенте
Процедура СбросИгры(Команда)
    Направление = Неопределено;
    Позиция = Неопределено;
    Очки = 0;
    ИграАктивна = Ложь;

    Объект.СтатусИгры = "Скинуто";
    Объект.Счетчик = 0;
КонецПроцедуры

// ----------------------------------------------------------------------------
// Обробники команд кешу (використовують серверні змінні)
// ----------------------------------------------------------------------------

&НаКлиенте
Процедура ЗагрузитьКеш(Команда)
    ЗагрузитьКешНаСервере();
    Сообщить("Кеш завантажено");
КонецПроцедуры

&НаСервере
Процедура ЗагрузитьКешНаСервере()
    // Використовуємо серверну змінну
    СерверныйКеш.Вставить("ДатаЗагрузки", ТекущаяДата());
    СерверныйКеш.Вставить("Пользователь", ИмяПользователя());
    СерверныйКеш.Вставить("КоличествоЗаписей", 100);

    Объект.СтатусИгры = "Кеш: " + СерверныйКеш.Количество() + " записів";
КонецПроцедуры

&НаКлиенте
Процедура ОчиститьКеш(Команда)
    ОчиститьКешНаСервере();
    Сообщить("Кеш очищено");
КонецПроцедуры

&НаСервере
Процедура ОчиститьКешНаСервере()
    СерверныйКеш.Очистить();
    Объект.СтатусИгры = "Кеш очищено";
КонецПроцедуры
