connection_string: "File=\"{temp_ib}\";"
epf_file_name: ТестированиеТаблицы.epf

tests:
  # Тест 1: Перевірка додавання 10 записів
  - name: test_add_10_records
    description: "Перевірка що кнопка 'Додати 10 записів' додає 10 записів у таблицю"
    type: procedural
    connection_type: Automation  # Використовуємо Automation Server для роботи з формою
    procedure: |
      // Отримуємо форму обробки
      Форма = ПолучитьФорму("ExternalDataProcessor.ТестированиеТаблицы.Form.Форма");

      // Перевіряємо що таблиця порожня на початку
      Если Форма.Данные.Количество() <> 0 Тогда
          ВызватьИсключение "Помилка: таблиця повинна бути порожня на початку тесту";
      КонецЕсли;

      // Натискаємо кнопку "Додати записи"
      Форма.ДобавитьЗаписи(Неопределено);

      // Перевіряємо що додалось 10 записів
      Если Форма.Данные.Количество() <> 10 Тогда
          ВызватьИсключение "Помилка: очікувалось 10 записів, отримано " + Формат(Форма.Данные.Количество(), "ЧГ=0");
      КонецЕсли;

      // Перевіряємо що перший запис має номер 1
      Если Форма.Данные[0].Номер <> 1 Тогда
          ВызватьИсключение "Помилка: перший запис повинен мати номер 1";
      КонецЕсли;

      // Перевіряємо що останній запис має номер 10
      Если Форма.Данные[9].Номер <> 10 Тогда
          ВызватьИсключение "Помилка: останній запис повинен мати номер 10";
      КонецЕсли;

      Сообщить("✓ Тест пройдено: успішно додано 10 записів");

  # Тест 2: Перевірка видалення останнього запису
  - name: test_delete_last_record
    description: "Перевірка що кнопка 'Видалити останній' видаляє останній запис"
    type: procedural
    connection_type: Automation
    procedure: |
      // Отримуємо форму
      Форма = ПолучитьФорму("ExternalDataProcessor.ТестованняТаблиці.Form.Форма");

      // Додаємо 10 записів
      Форма.ДобавитьЗаписи(Неопределено);

      // Зберігаємо опис останнього запису
      ОписОстаннього = Форма.Данные[9].Опис;

      // Видаляємо останній запис
      Форма.УдалитьПоследнюю(Неопределено);

      // Перевіряємо що залишилось 9 записів
      Если Форма.Данные.Количество() <> 9 Тогда
          ВызватьИсключение "Помилка: очікувалось 9 записів, отримано " + Формат(Форма.Данные.Количество(), "ЧГ=0");
      КонецЕсли;

      // Перевіряємо що новий останній запис - це колишній передостанній
      Если Форма.Данные[8].Номер <> 9 Тогда
          ВызватьИсключение "Помилка: останній запис повинен мати номер 9";
      КонецЕсли;

      Сообщить("✓ Тест пройдено: успішно видалено останній запис");

  # Тест 3: Комплексний тест - додавання та видалення
  - name: test_add_and_delete_multiple
    description: "Комплексний тест: додати 10, видалити 3, додати ще 10"
    type: procedural
    connection_type: Automation
    procedure: |
      Форма = ПолучитьФорму("ExternalDataProcessor.ТестованняТаблиці.Form.Форма");

      // Крок 1: Додаємо 10 записів
      Форма.ДобавитьЗаписи(Неопределено);
      Если Форма.Данные.Количество() <> 10 Тогда
          ВызватьИсключение "Крок 1 не пройдено: очікувалось 10 записів";
      КонецЕсли;

      // Крок 2: Видаляємо 3 записи
      Для І = 1 По 3 Цикл
          Форма.УдалитьПоследнюю(Неопределено);
      КонецЦикла;

      Если Форма.Данные.Количество() <> 7 Тогда
          ВызватьИсключение "Крок 2 не пройдено: очікувалось 7 записів, отримано " + Формат(Форма.Данные.Количество(), "ЧГ=0");
      КонецЕсли;

      // Крок 3: Додаємо ще 10 записів
      Форма.ДобавитьЗаписи(Неопределено);

      Если Форма.Данные.Количество() <> 17 Тогда
          ВызватьИсключение "Крок 3 не пройдено: очікувалось 17 записів, отримано " + Формат(Форма.Данные.Количество(), "ЧГ=0");
      КонецЕсли;

      Сообщить("✓ Комплексний тест пройдено: 10 + (-3) + 10 = 17 записів");

  # Тест 4: Видалення з порожньої таблиці (граничний випадок)
  - name: test_delete_from_empty_table
    description: "Перевірка що видалення з порожньої таблиці не викликає помилки"
    type: procedural
    connection_type: Automation
    procedure: |
      Форма = ПолучитьФорму("ExternalDataProcessor.ТестованняТаблиці.Form.Форма");

      // Таблиця порожня, пробуємо видалити
      Форма.УдалитьПоследнюю(Неопределено);

      // Перевіряємо що таблиця все ще порожня і помилки не було
      Если Форма.Данные.Количество() <> 0 Тогда
          ВызватьИсключение "Помилка: таблиця повинна залишитись порожньою";
      КонецЕсли;

      Сообщить("✓ Тест пройдено: видалення з порожньої таблиці оброблено коректно");
