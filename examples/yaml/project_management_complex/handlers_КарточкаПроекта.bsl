// ============================================================================
// ФОРМА КАРТКИ ПРОЕКТУ (КарточкаПроекта)
// ============================================================================

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	Если Параметры.Свойство("РежимСоздания") Тогда
		РежимСоздания = Параметры.РежимСоздания;
	Иначе
		РежимСоздания = Истина;
	КонецЕсли;

	Если НЕ РежимСоздания И Параметры.Свойство("ДанныеПроекта") Тогда
		ЗагрузитьДанныеПроектаНаСервере(Параметры.ДанныеПроекта);
	Иначе
		ИнициализироватьНовыйПроектНаСервере();
	КонецЕсли;

	Если Параметры.Свойство("ИмяОсновнойФормы") Тогда
		ИмяОсновнойФормы = Параметры.ИмяОсновнойФормы;
	КонецЕсли;
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	// Серверна ініціалізація
КонецПроцедуры

&НаСервере
Процедура ЗагрузитьДанныеПроектаНаСервере(ДанныеПроекта)
	ЗаполнитьЗначенияСвойств(ЭтотОбъект.Объект.Проекты[0], ДанныеПроекта);

	// Завантаження учасників проекту (якщо є)
	// ...
КонецПроцедуры

&НаСервере
Процедура ИнициализироватьНовыйПроектНаСервере()
	НоваяСтрока = Объект.Проекты.Добавить();
	НоваяСтрока.ПроектИД = Строка(Новый УникальныйИдентификатор);
	НоваяСтрока.Статус = "Планирование";
	НоваяСтрока.Приоритет = "Средний";
	НоваяСтрока.Прогресс = 0;
	НоваяСтрока.ДатаНачала = ТекущаяДата();
КонецПроцедуры

&НаКлиенте
Процедура СохранитьПроект(Команда)
	// Валідація
	Если НЕ ПроверитьЗаполнениеПроектаНаСервере() Тогда
		Возврат;
	КонецЕсли;

	// Підготовка результату
	Результат = Новый Структура;
	Результат.Вставить("Сохранено", Истина);
	Результат.Вставить("РежимСоздания", РежимСоздания);
	Результат.Вставить("ДанныеПроекта", ПолучитьДанныеПроектаНаСервере());

	Закрыть(Результат);
КонецПроцедуры

&НаСервере
Функция ПроверитьЗаполнениеПроектаНаСервере()
	Проект = Объект.Проекты[0];

	Если НЕ ЗначениеЗаполнено(Проект.Название) Тогда
		Сообщить("Укажите название проекта!");
		Возврат Ложь;
	КонецЕсли;

	Если НЕ ЗначениеЗаполнено(Проект.Код) Тогда
		Сообщить("Укажите код проекта!");
		Возврат Ложь;
	КонецЕсли;

	Возврат Истина;
КонецФункции

&НаСервере
Функция ПолучитьДанныеПроектаНаСервере()
	Проект = Объект.Проекты[0];

	ДанныеПроекта = Новый Структура;
	Для Каждого Колонка Из Объект.Проекты.Колонки Цикл
		ДанныеПроекта.Вставить(Колонка.Имя, Проект[Колонка.Имя]);
	КонецЦикла;

	Возврат ДанныеПроекта;
КонецФункции

&НаКлиенте
Процедура ОтменитьПроект(Команда)
	Закрыть();
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьУчастника(Команда)
	НоваяСтрока = УчастникиПроекта.Добавить();
	НоваяСтрока.ДатаНачала = ТекущаяДата();
	Сообщить("Заполните данные участника");
КонецПроцедуры

&НаКлиенте
Процедура УдалитьУчастника(Команда)
	ТекущаяСтрока = Элементы.ТаблицаУчастниковПроекта.ТекущиеДанные;

	Если ТекущаяСтрока <> Неопределено Тогда
		УчастникиПроекта.Удалить(ТекущаяСтрока);
		Сообщить("Участник удален");
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура РассчитатьБюджет(Команда)
	РассчитатьБюджетНаСервере();
	Сообщить("Бюджет рассчитан!");
КонецПроцедуры

&НаСервере
Процедура РассчитатьБюджетНаСервере()
	// Розрахунок бюджету на основі ресурсів та задач
	Проект = Объект.Проекты[0];

	// Простий розрахунок для демонстрації
	ОценочныйБюджет = 0;

	Для Каждого Участник Из УчастникиПроекта Цикл
		// Припустимо 160 годин на місяць
		ОценочныйБюджет = ОценочныйБюджет + 160 * 2500; // 2500 - середня ставка
	КонецЦикла;

	Проект.Бюджет = ОценочныйБюджет;
КонецПроцедуры

&НаКлиенте
Процедура ПросмотрЗадач(Команда)
	Сообщить("Открывается список задач проекта (функция в разработке)");
КонецПроцедуры

&НаКлиенте
Процедура ИсторияИзменений(Команда)
	Сообщить("История изменений проекта (функция в разработке)");
КонецПроцедуры

&НаКлиенте
Процедура ЭкспортПроекта(Команда)
	ЭкспортПроектаНаСервере();
	Сообщить("Проект экспортирован!");
КонецПроцедуры

&НаСервере
Процедура ЭкспортПроектаНаСервере()
	// Експорт проекту
КонецПроцедуры
