// ============================================================================
// ФОРМА НАЛАШТУВАНЬ (ФормаНастроек)
// ============================================================================

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	Если Параметры.Свойство("ИмяОсновнойФормы") Тогда
		ИмяОсновнойФормы = Параметры.ИмяОсновнойФормы;
	КонецЕсли;
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	// Завантаження поточних налаштувань
	ЗагрузитьТекущиеНастройкиНаСервере();
КонецПроцедуры

&НаСервере
Процедура ЗагрузитьТекущиеНастройкиНаСервере()
	// Встановлення значень за замовчуванням
	Если НЕ ЗначениеЗаполнено(Объект.РежимОтображения) Тогда
		Объект.РежимОтображения = "Таблица";
	КонецЕсли;

	Если НЕ ЗначениеЗаполнено(Объект.ЦветовойРежим) Тогда
		Объект.ЦветовойРежим = "Светлая";
	КонецЕсли;

	Если Объект.РазмерШрифта = 0 Тогда
		Объект.РазмерШрифта = 10;
	КонецЕсли;

	Если Объект.АвтообновлениеСекунд = 0 Тогда
		Объект.АвтообновлениеСекунд = 60;
	КонецЕсли;

	Если НЕ ЗначениеЗаполнено(Объект.ФорматЭкспорта) Тогда
		Объект.ФорматЭкспорта = "XML";
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура СохранитьНастройки(Команда)
	// Валідація налаштувань
	Если НЕ ПроверитьНастройкиНаСервере() Тогда
		Возврат;
	КонецЕсли;

	Результат = Новый Структура;
	Результат.Вставить("Сохранено", Истина);
	Результат.Вставить("Настройки", ПолучитьНастройкиНаСервере());

	Закрыть(Результат);
	Сообщить("Настройки сохранены!");
КонецПроцедуры

&НаСервере
Функция ПроверитьНастройкиНаСервере()
	Если Объект.АвтообновлениеСекунд < 0 Тогда
		Сообщить("Интервал автообновления не может быть отрицательным!");
		Возврат Ложь;
	КонецЕсли;

	Если Объект.РазмерШрифта < 8 ИЛИ Объект.РазмерШрифта > 24 Тогда
		Сообщить("Размер шрифта должен быть от 8 до 24!");
		Возврат Ложь;
	КонецЕсли;

	Возврат Истина;
КонецФункции

&НаСервере
Функция ПолучитьНастройкиНаСервере()
	Настройки = Новый Структура;
	Настройки.Вставить("РежимОтображения", Объект.РежимОтображения);
	Настройки.Вставить("ЦветовойРежим", Объект.ЦветовойРежим);
	Настройки.Вставить("РазмерШрифта", Объект.РазмерШрифта);
	Настройки.Вставить("АвтообновлениеСекунд", Объект.АвтообновлениеСекунд);
	Настройки.Вставить("ПоказыватьЗакрытые", Объект.ПоказыватьЗакрытые);
	Настройки.Вставить("ПоказыватьАрхивные", Объект.ПоказыватьАрхивные);
	Настройки.Вставить("ГруппировкаПоПроектам", Объект.ГруппировкаПоПроектам);
	Настройки.Вставить("ФильтрСтатус", Объект.ФильтрСтатус);
	Настройки.Вставить("ФильтрПриоритет", Объект.ФильтрПриоритет);
	Настройки.Вставить("ПутьЭкспорта", Объект.ПутьЭкспорта);
	Настройки.Вставить("ФорматЭкспорта", Объект.ФорматЭкспорта);

	Возврат Настройки;
КонецФункции

&НаКлиенте
Процедура ОтменитьНастройки(Команда)
	Закрыть();
КонецПроцедуры

&НаКлиенте
Процедура СброситьПоУмолчанию(Команда)
	Ответ = Вопрос(
		"Сбросить все настройки к значениям по умолчанию?",
		РежимДиалогаВопрос.ДаНет
	);

	Если Ответ = КодВозвратаДиалога.Да Тогда
		СброситьНастройкиНаСервере();
		Сообщить("Настройки сброшены к значениям по умолчанию!");
	КонецЕсли;
КонецПроцедуры

&НаСервере
Процедура СброситьНастройкиНаСервере()
	Объект.РежимОтображения = "Таблица";
	Объект.ЦветовойРежим = "Светлая";
	Объект.РазмерШрифта = 10;
	Объект.АвтообновлениеСекунд = 60;
	Объект.ПоказыватьЗакрытые = Ложь;
	Объект.ПоказыватьАрхивные = Ложь;
	Объект.ГруппировкаПоПроектам = Истина;
	Объект.ФильтрСтатус = "";
	Объект.ФильтрПриоритет = "";
	Объект.ПутьЭкспорта = "";
	Объект.ФорматЭкспорта = "XML";
КонецПроцедуры
