// ============================================================================
// ФОРМА ЗВІТІВ (ФормаОтчетов)
// ============================================================================

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	Если Параметры.Свойство("ИмяОсновнойФормы") Тогда
		ИмяОсновнойФормы = Параметры.ИмяОсновнойФормы;
	КонецЕсли;
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	// Ініціалізація дат фільтра
	Если НЕ ЗначениеЗаполнено(Объект.ФильтрДатаНачала) Тогда
		Объект.ФильтрДатаНачала = НачалоМесяца(ТекущаяДата());
	КонецЕсли;

	Если НЕ ЗначениеЗаполнено(Объект.ФильтрДатаОкончания) Тогда
		Объект.ФильтрДатаОкончания = КонецМесяца(ТекущаяДата());
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура СформироватьОтчетПроектов(Команда)
	СформироватьОтчетПроектовНаСервере();
	Сообщить("Отчет по проектам сформирован!");
КонецПроцедуры

&НаСервере
Процедура СформироватьОтчетПроектовНаСервере()
	ОтчетПоПроектам.Очистить();

	// Завантажуємо дані з основної форми (якщо є доступ)
	// Для демонстрації створюємо тестові дані
	НоваяСтрока = ОтчетПоПроектам.Добавить();
	НоваяСтрока.Проект = "Модернизация системы учета";
	НоваяСтрока.Статус = "Активный";
	НоваяСтрока.ВсегоЗадач = 25;
	НоваяСтрока.Выполнено = 10;
	НоваяСтрока.ВРаботе = 8;
	НоваяСтрока.Просрочено = 2;
	НоваяСтрока.Прогресс = 40;
	НоваяСтрока.Бюджет = 500000;
	НоваяСтрока.Затраты = 200000;
	НоваяСтрока.Отклонение = 300000;

	НоваяСтрока = ОтчетПоПроектам.Добавить();
	НоваяСтрока.Проект = "Внедрение CRM";
	НоваяСтрока.Статус = "Планирование";
	НоваяСтрока.ВсегоЗадач = 15;
	НоваяСтрока.Выполнено = 2;
	НоваяСтрока.ВРаботе = 5;
	НоваяСтрока.Просрочено = 0;
	НоваяСтрока.Прогресс = 13;
	НоваяСтрока.Бюджет = 800000;
	НоваяСтрока.Затраты = 50000;
	НоваяСтрока.Отклонение = 750000;
КонецПроцедуры

&НаКлиенте
Процедура СформироватьОтчетЗадач(Команда)
	СформироватьОтчетЗадачНаСервере();
	Сообщить("Отчет по задачам сформирован!");
КонецПроцедуры

&НаСервере
Процедура СформироватьОтчетЗадачНаСервере()
	ОтчетПоЗадачам.Очистить();

	// Тестові дані
	НоваяСтрока = ОтчетПоЗадачам.Добавить();
	НоваяСтрока.Проект = "Модернизация системы учета";
	НоваяСтрока.Задача = "Анализ текущей системы";
	НоваяСтрока.Исполнитель = "Иванов И.И.";
	НоваяСтрока.Статус = "Выполнена";
	НоваяСтрока.Приоритет = "Высокий";
	НоваяСтрока.ДатаНачала = '20250102';
	НоваяСтрока.ДатаОкончания = '20250115';
	НоваяСтрока.Прогресс = 100;

	НоваяСтрока = ОтчетПоЗадачам.Добавить();
	НоваяСтрока.Проект = "Модернизация системы учета";
	НоваяСтрока.Задача = "Разработка плана миграции";
	НоваяСтрока.Исполнитель = "Сидоров С.С.";
	НоваяСтрока.Статус = "В работе";
	НоваяСтрока.Приоритет = "Высокий";
	НоваяСтрока.ДатаНачала = '20250116';
	НоваяСтрока.ДатаОкончания = '20250201';
	НоваяСтрока.Прогресс = 50;
КонецПроцедуры

&НаКлиенте
Процедура СформироватьОтчетРесурсов(Команда)
	СформироватьОтчетРесурсовНаСервере();
	Сообщить("Отчет по ресурсам сформирован!");
КонецПроцедуры

&НаСервере
Процедура СформироватьОтчетРесурсовНаСервере()
	ОтчетПоРесурсам.Очистить();

	НоваяСтрока = ОтчетПоРесурсам.Добавить();
	НоваяСтрока.Ресурс = "Иванов Иван Иванович";
	НоваяСтрока.Тип = "Сотрудник";
	НоваяСтрока.КоличествоПроектов = 2;
	НоваяСтрока.КоличествоЗадач = 8;
	НоваяСтрока.ЗагрузкаЧасов = 160;
	НоваяСтрока.Доступность = 100;
	НоваяСтрока.Стоимость = 480000;

	НоваяСтрока = ОтчетПоРесурсам.Добавить();
	НоваяСтрока.Ресурс = "Петрова Петра Петровна";
	НоваяСтрока.Тип = "Сотрудник";
	НоваяСтрока.КоличествоПроектов = 1;
	НоваяСтрока.КоличествоЗадач = 5;
	НоваяСтрока.ЗагрузкаЧасов = 128;
	НоваяСтрока.Доступность = 80;
	НоваяСтрока.Стоимость = 320000;
КонецПроцедуры

&НаКлиенте
Процедура СформироватьОтчетВремени(Команда)
	СформироватьОтчетВремениНаСервере();
	Сообщить("Отчет по времени сформирован!");
КонецПроцедуры

&НаСервере
Процедура СформироватьОтчетВремениНаСервере()
	ОтчетПоВремени.Очистить();

	НоваяСтрока = ОтчетПоВремени.Добавить();
	НоваяСтрока.Период = "Январь 2025";
	НоваяСтрока.Проект = "Модернизация системы учета";
	НоваяСтрока.Исполнитель = "Иванов И.И.";
	НоваяСтрока.ПлановоеВремя = 120;
	НоваяСтрока.ФактическоеВремя = 98;
	НоваяСтрока.Отклонение = -22;
	НоваяСтрока.ОтклонениеПроцент = -18.3;

	НоваяСтрока = ОтчетПоВремени.Добавить();
	НоваяСтрока.Период = "Январь 2025";
	НоваяСтрока.Проект = "Разработка мобильного приложения";
	НоваяСтрока.Исполнитель = "Сидоров С.С.";
	НоваяСтрока.ПлановоеВремя = 160;
	НоваяСтрока.ФактическоеВремя = 175;
	НоваяСтрока.Отклонение = 15;
	НоваяСтрока.ОтклонениеПроцент = 9.4;
КонецПроцедуры

&НаКлиенте
Процедура ЭкспортироватьОтчет(Команда)
	ЭкспортироватьОтчетНаСервере();
	Сообщить("Отчет экспортирован!");
КонецПроцедуры

&НаСервере
Процедура ЭкспортироватьОтчетНаСервере()
	// Експорт поточного звіту
КонецПроцедуры

&НаКлиенте
Процедура ПечатьОтчета(Команда)
	Сообщить("Печать отчета (функция в разработке)");
КонецПроцедуры

&НаКлиенте
Процедура ДокументОтчетаОбработкаРасшифровки(Элемент, Расшифровка, СтандартнаяОбработка)
	// Drill-down в табличному документі
	СтандартнаяОбработка = Ложь;

	Если Расшифровка <> Неопределено Тогда
		Сообщить(СтрШаблон("Расшифровка: %1", Расшифровка));
	КонецЕсли;
КонецПроцедуры
