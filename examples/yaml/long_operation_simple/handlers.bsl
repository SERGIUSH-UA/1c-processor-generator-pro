#Область ДлительныеОперации

// ========================================
// ОПЦИОНАЛЬНЫЕ ХЕНДЛЕРЫ (convention-based)
// ========================================

// Валидация перед запуском (опционально)
// Если функция существует, автоматически вызывается в ImportКнопка
&НаКлиенте
Функция ImportПроверкаПередЗапуском()
	Если ПустаяСтрока(Объект.FilePath) Тогда
		Сообщить("⚠️ Укажите путь к файлу!");
		Возврат Ложь;
	КонецЕсли;

	Возврат Истина;
КонецФункции

// Обработка результата после завершения (опционально)
// Если процедура существует, автоматически вызывается в ImportЗавершение
&НаКлиенте
Процедура ImportОбработкаРезультата(РезультатОперации)
	Если РезультатОперации <> Неопределено Тогда
		// Обновляем UI с результатами
		Объект.RowsProcessed = РезультатОперации.ОбработаноСтрок;
		Сообщить("✅ Обработано строк: " + Объект.RowsProcessed);
	КонецЕсли;
КонецПроцедуры

// ========================================
// ОБЯЗАТЕЛЬНЫЙ ХЕНДЛЕР
// ========================================

// Business logic (обязательно)
&НаСервере
Процедура ImportНаСервере(Параметры, АдресРезультата) Экспорт

	// Получаем путь к файлу из параметров (если передан)
	ПутьКФайлу = "";
	Если Параметры.Свойство("ПутьКФайлу") Тогда
		ПутьКФайлу = Параметры.ПутьКФайлу;
	КонецЕсли;

	// Симуляция импорта данных (для примера)
	// В реальном коде здесь будет чтение файла

	Счетчик = 0;
	МаксимумСтрок = 100;

	Для Индекс = 1 По МаксимумСтрок Цикл

		// Симуляция обработки строки
		// В реальном коде: парсинг CSV, чтение Excel, обработка данных
		Счетчик = Счетчик + 1;

		// Небольшая задержка для демонстрации длительной операции
		// В production коде этого не будет - реальная работа займет время

		// Отчет о прогрессе каждые 10 строк
		Если Счетчик % 10 = 0 Тогда
			Процент = Счетчик / МаксимумСтрок * 100;
			ТекстПрогресса = СтрШаблон("Обработано строк: %1 из %2", Счетчик, МаксимумСтрок);
			ДлительныеОперации.СообщитьПрогресс(Процент, ТекстПрогресса);
		КонецЕсли;

	КонецЦикла;

	// Формируем результат
	Результат = Новый Структура;
	Результат.Вставить("ОбработаноСтрок", Счетчик);
	Результат.Вставить("Успешно", Истина);
	Результат.Вставить("Сообщение", "Импорт завершен успешно");

	// Помещаем результат во временное хранилище
	ПоместитьВоВременноеХранилище(Результат, АдресРезультата);

КонецПроцедуры

#КонецОбласти
