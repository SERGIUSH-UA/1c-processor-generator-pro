// ============================================
// ColumnGroup Example Handlers (v2.37.0+ Phase 2 Complete)
// ============================================

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура LoadData(Команда)
	LoadDataНаСервере();
	CalculateTotals();
	Сообщить("Данные загружены: " + Объект.Operations.Количество() + " операций");
КонецПроцедуры

&НаКлиенте
Процедура Calculate(Команда)
	CalculateTotals();
	Сообщить("Итоги рассчитаны");
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовФормы

&НаКлиенте
Процедура OperationsTableOnActivateRow(Элемент)
	// Получаем текущую строку таблицы
	ТекущаяСтрока = Элементы.OperationsTable.ТекущиеДанные;

	Если ТекущаяСтрока = Неопределено Тогда
		Возврат;
	КонецЕсли;

	// Показываем информацию о выбранной операции
	Инфо = СтрШаблон("Операция: %1, Дата: %2, Дебет: %3, Кредит: %4",
		ТекущаяСтрока.Operation,
		Формат(ТекущаяСтрока.Date, "ДЛФ=D"),
		ТекущаяСтрока.Debit,
		ТекущаяСтрока.Credit);

	Сообщить(Инфо);
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура LoadDataНаСервере()
	// Очищаем таблицу
	Объект.Operations.Очистить();

	// Добавляем тестовые данные
	// Группа 1: Операции с датой 15.01.2025
	НоваяСтрока = Объект.Operations.Добавить();
	НоваяСтрока.Operation = "Оплата від покупця №1";
	НоваяСтрока.Date = Дата(2025, 1, 15);
	НоваяСтрока.Time = "10:30:00";
	НоваяСтрока.Debit = 15000;
	НоваяСтрока.Credit = 0;
	НоваяСтрока.Total = 15000;
	НоваяСтрока.Status = "Проведено";

	НоваяСтрока = Объект.Operations.Добавить();
	НоваяСтрока.Operation = "Оплата постачальнику №1";
	НоваяСтрока.Date = Дата(2025, 1, 15);
	НоваяСтрока.Time = "14:15:00";
	НоваяСтрока.Debit = 0;
	НоваяСтрока.Credit = 8000;
	НоваяСтрока.Total = -8000;
	НоваяСтрока.Status = "Проведено";

	// Группа 2: Операции с датой 16.01.2025
	НоваяСтрока = Объект.Operations.Добавить();
	НоваяСтрока.Operation = "Оплата від покупця №2";
	НоваяСтрока.Date = Дата(2025, 1, 16);
	НоваяСтрока.Time = "09:00:00";
	НоваяСтрока.Debit = 22000;
	НоваяСтрока.Credit = 0;
	НоваяСтрока.Total = 22000;
	НоваяСтрока.Status = "Проведено";

	НоваяСтрока = Объект.Operations.Добавить();
	НоваяСтрока.Operation = "Виплата зарплати";
	НоваяСтрока.Date = Дата(2025, 1, 16);
	НоваяСтрока.Time = "16:30:00";
	НоваяСтрока.Debit = 0;
	НоваяСтрока.Credit = 12000;
	НоваяСтрока.Total = -12000;
	НоваяСтрока.Status = "Проведено";

	// Группа 3: Операции с датой 17.01.2025
	НоваяСтрока = Объект.Operations.Добавить();
	НоваяСтрока.Operation = "Оплата від покупця №3";
	НоваяСтрока.Date = Дата(2025, 1, 17);
	НоваяСтрока.Time = "11:45:00";
	НоваяСтрока.Debit = 18500;
	НоваяСтрока.Credit = 0;
	НоваяСтрока.Total = 18500;
	НоваяСтрока.Status = "В обробці";

	НоваяСтрока = Объект.Operations.Добавить();
	НоваяСтрока.Operation = "Оплата комунальних послуг";
	НоваяСтрока.Date = Дата(2025, 1, 17);
	НоваяСтрока.Time = "15:00:00";
	НоваяСтрока.Debit = 0;
	НоваяСтрока.Credit = 3500;
	НоваяСтрока.Total = -3500;
	НоваяСтрока.Status = "Проведено";
КонецПроцедуры

&НаКлиенте
Процедура CalculateTotals()
	// Рассчитываем общие суммы дебета и кредита
	ВсегоДебет = 0;
	ВсегоКредит = 0;

	Для Каждого Строка Из Объект.Operations Цикл
		ВсегоДебет = ВсегоДебет + Строка.Debit;
		ВсегоКредит = ВсегоКредит + Строка.Credit;
	КонецЦикла;

	Объект.TotalDebit = ВсегоДебет;
	Объект.TotalCredit = ВсегоКредит;

	// Показываем баланс
	Баланс = ВсегоДебет - ВсегоКредит;

	Если Баланс > 0 Тогда
		СтатусБаланса = "Прибуток: " + Формат(Баланс, "ЧЦ=15; ЧДЦ=2");
	ИначеЕсли Баланс < 0 Тогда
		СтатусБаланса = "Збиток: " + Формат(-Баланс, "ЧЦ=15; ЧДЦ=2");
	Иначе
		СтатусБаланса = "Баланс нульовий";
	КонецЕсли;

	Сообщить("Всього дебет: " + Формат(ВсегоДебет, "ЧЦ=15; ЧДЦ=2"));
	Сообщить("Всього кредит: " + Формат(ВсегоКредит, "ЧЦ=15; ЧДЦ=2"));
	Сообщить(СтатусБаланса);
КонецПроцедуры

#КонецОбласти
